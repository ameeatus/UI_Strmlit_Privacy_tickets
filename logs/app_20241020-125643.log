2024-10-20 12:56:43,466 INFO root ScriptRunner.scriptThread : Log file created: C:\Users\5J4224897\Projects\UI_Strmlit_Privacy_tickets\logs/app_20241020-125643.log
2024-10-20 12:58:22,297 INFO root ScriptRunner.scriptThread : Log file created: C:\Users\5J4224897\Projects\UI_Strmlit_Privacy_tickets\logs/app_20241020-125822.log
2024-10-20 12:58:22,993 INFO snowflake.connector.connection ScriptRunner.scriptThread : Snowflake Connector for Python Version: 3.12.2, Python Version: 3.9.12, Platform: Windows-10-10.0.22631-SP0
2024-10-20 12:58:22,993 INFO snowflake.connector.connection ScriptRunner.scriptThread : Connecting to GLOBAL Snowflake domain
2024-10-20 12:58:22,994 INFO snowflake.connector.connection ScriptRunner.scriptThread : This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2024-10-20 12:58:23,946 INFO snowflake.connector.connection ScriptRunner.scriptThread : closed
2024-10-20 12:58:24,039 INFO snowflake.connector.connection ScriptRunner.scriptThread : No async queries seem to be running, deleting session
2024-10-20 12:59:19,850 INFO root ScriptRunner.scriptThread : Log file created: C:\Users\5J4224897\Projects\UI_Strmlit_Privacy_tickets\logs/app_20241020-125919.log
2024-10-20 12:59:20,585 INFO snowflake.connector.connection ScriptRunner.scriptThread : Snowflake Connector for Python Version: 3.12.2, Python Version: 3.9.12, Platform: Windows-10-10.0.22631-SP0
2024-10-20 12:59:20,585 INFO snowflake.connector.connection ScriptRunner.scriptThread : Connecting to GLOBAL Snowflake domain
2024-10-20 12:59:20,586 INFO snowflake.connector.connection ScriptRunner.scriptThread : This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2024-10-20 12:59:21,655 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 1
2024-10-20 12:59:23,164 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 1
2024-10-20 12:59:24,107 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 8
2024-10-20 12:59:24,205 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 1
2024-10-20 12:59:24,625 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 1
2024-10-20 12:59:25,718 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 1
2024-10-20 12:59:25,719 INFO root ScriptRunner.scriptThread : Successfully uploaded 9 rows to 'INPUT_RECORDS' table in Snowflake.
2024-10-20 12:59:26,961 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 3
2024-10-20 12:59:26,961 INFO root ScriptRunner.scriptThread : Column - {column_name}  already exist in the table.
2024-10-20 12:59:26,961 INFO root ScriptRunner.scriptThread : Column - {column_name}  already exist in the table.
2024-10-20 12:59:26,961 INFO root ScriptRunner.scriptThread : Column - {column_name}  already exist in the table.
2024-10-20 12:59:26,961 INFO root ScriptRunner.scriptThread : Update Query: 
        UPDATE INPUT_RECORDS
        SET
            firstname_vector = SNOWFLAKE.CORTEX.EMBED_TEXT_768('snowflake-arctic-embed-m', firstname),
            lastname_vector = SNOWFLAKE.CORTEX.EMBED_TEXT_768('snowflake-arctic-embed-m', lastname),
            address_vector = SNOWFLAKE.CORTEX.EMBED_TEXT_768('snowflake-arctic-embed-m',address);
        
2024-10-20 12:59:27,721 INFO root ScriptRunner.scriptThread : Embeddings calculated and stored back in 'INPUT_RECORDS' table.
2024-10-20 12:59:27,723 INFO root ScriptRunner.scriptThread : Matching Rules Query: 
        WITH VECTOR_DATA AS (
        SELECT
            id,
            task_id,
            firstname,
            lastname,
            dob,
            GENDER,
            COUNTRY,
            firstname_vector,
            lastname_vector,
            address_vector
        FROM INPUT_RECORDS
        )
        SELECT
                a.task_id as task_id,
                A.id AS id_a,
                B.id AS id_b,
                A.DOB as dob_a,
                B.DOB as dob_b,
                A.GENDER as gender_a,
                B.GENDER as gender_b,
                A.firstname as firstname_a,
                B.firstname as firstname_b,
                A.lastname as lastname_a,
                B.lastname as lastname_b,
                A.firstname || ' ' || A.lastname || ' ' || A.DOB || ' ' || A.Gender || ' ' || A.COUNTRY AS first_record,
                B.firstname || ' ' || B.lastname || ' ' || B.DOB || ' ' || B.Gender || ' ' || B.COUNTRY AS second_record,
                CASE
                WHEN A.FIRSTNAME = B.FIRSTNAME
                    AND A.LASTNAME = B.LASTNAME
                    AND COALESCE(A.DOB,'11110101') = COALESCE(B.DOB,'11110101')
                    AND COALESCE(A.GENDER,'UNK') = COALESCE(B.GENDER,'UNK')
                THEN 'Exact firstname+lastname+dob+gender'
                when VECTOR_COSINE_SIMILARITY(A.firstname_vector,B.firstname_vector) > 0.95
                    AND VECTOR_COSINE_SIMILARITY(A.lastname_vector,B.lastname_vector) > 0.95
                    AND COALESCE(A.DOB,'11110101') = COALESCE(B.DOB,'11110101')
                    AND COALESCE(A.GENDER,'UNK') = COALESCE(B.GENDER,'UNK')
                THEN 'hc-firstname+hc-lastname | Exact DOB+gender'
                WHEN VECTOR_COSINE_SIMILARITY(A.ADDRESS_VECTOR, B.ADDRESS_VECTOR) > 0.9
                    AND VECTOR_COSINE_SIMILARITY(A.firstname_vector,B.firstname_vector) > 0.9
                    AND VECTOR_COSINE_SIMILARITY(A.lastname_vector,B.lastname_vector) > 0.9
                    AND COALESCE(A.DOB,'11110101') = COALESCE(B.DOB,'11110101')
                THEN 'lc firstname+lastname + hc-address  | Exact DOB+gender'
                WHEN EDITDISTANCE(A.LASTNAME, B.LASTNAME) < 3 
                THEN 'Fuzzy Match on Lastname'
                ELSE 'No Match'
                END AS MATCH_TYPE,
                VECTOR_COSINE_SIMILARITY(A.firstname_vector,B.firstname_vector) as fn_similarity_score,
                VECTOR_COSINE_SIMILARITY(A.lastname_vector,B.lastname_vector) as ln_similarity_score,
                VECTOR_COSINE_SIMILARITY(A.ADDRESS_VECTOR, B.ADDRESS_VECTOR) as adrs_similarity_score
            FROM VECTOR_DATA A
            JOIN VECTOR_DATA B ON A.id < B.id
            and A.task_id = B.task_id;
            
2024-10-20 12:59:28,086 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 10
2024-10-20 12:59:28,239 INFO snowflake.connector.cursor ScriptRunner.scriptThread : Number of results in first chunk: 9
2024-10-20 12:59:28,267 INFO root ScriptRunner.scriptThread : Records grouped successfully
2024-10-20 12:59:29,168 INFO snowflake.connector.connection ScriptRunner.scriptThread : closed
2024-10-20 12:59:29,225 INFO snowflake.connector.connection ScriptRunner.scriptThread : No async queries seem to be running, deleting session
2024-10-20 13:15:38,750 INFO root ScriptRunner.scriptThread : Log file created: C:\Users\5J4224897\Projects\UI_Strmlit_Privacy_tickets\logs/app_20241020-131538.log
2024-10-20 13:15:39,478 INFO snowflake.connector.connection ScriptRunner.scriptThread : Snowflake Connector for Python Version: 3.12.2, Python Version: 3.9.12, Platform: Windows-10-10.0.22631-SP0
2024-10-20 13:15:39,480 INFO snowflake.connector.connection ScriptRunner.scriptThread : Connecting to GLOBAL Snowflake domain
2024-10-20 13:15:39,480 INFO snowflake.connector.connection ScriptRunner.scriptThread : This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2024-10-20 13:15:40,293 INFO snowflake.connector.connection ScriptRunner.scriptThread : closed
2024-10-20 13:15:40,337 INFO snowflake.connector.connection ScriptRunner.scriptThread : No async queries seem to be running, deleting session
2024-10-20 13:15:58,738 INFO root ScriptRunner.scriptThread : Log file created: C:\Users\5J4224897\Projects\UI_Strmlit_Privacy_tickets\logs/app_20241020-131558.log
2024-10-20 13:15:59,407 INFO snowflake.connector.connection ScriptRunner.scriptThread : Snowflake Connector for Python Version: 3.12.2, Python Version: 3.9.12, Platform: Windows-10-10.0.22631-SP0
2024-10-20 13:15:59,407 INFO snowflake.connector.connection ScriptRunner.scriptThread : Connecting to GLOBAL Snowflake domain
2024-10-20 13:15:59,407 INFO snowflake.connector.connection ScriptRunner.scriptThread : This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2024-10-20 13:16:20,778 ERROR root ScriptRunner.scriptThread : Error validating SQL: 001003 (42000): 01b7d20c-020b-234c-0009-3bf7000232f6: SQL compilation error:
syntax error line 1 at position 0 unexpected 'You'.
2024-10-20 13:16:20,780 INFO snowflake.connector.connection ScriptRunner.scriptThread : closed
2024-10-20 13:16:20,841 INFO snowflake.connector.connection ScriptRunner.scriptThread : No async queries seem to be running, deleting session
